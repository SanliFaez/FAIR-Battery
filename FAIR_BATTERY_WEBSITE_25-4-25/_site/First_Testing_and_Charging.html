<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>first_testing_and_charging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9eb995e8644016eb670a0cb3bf478a26.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./FAIR_Battery_Main.html" aria-current="page"> 
<span class="menu-text">FAIR Battery Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Community.html"> 
<span class="menu-text">Community</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Contributing.html"> 
<span class="menu-text">Contributing to FAIR-Battery</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Testing.html">Testing</a></li><li class="breadcrumb-item"><a href="./First_Testing_and_Charging.html">First testing and charging of the battery</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FAIR_Battery_Main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ready to Build Your Own FAIR-Battery?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Battery Build Up.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Battery 101</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Componants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Components</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FBRC_project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Build</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./First_Testing_and_Charging.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">First testing and charging of the battery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Charge_Discharge_Testing_Updated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Charge-Discharge Testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Testing Stability Electrode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing Stability Electrode (THIS FILE IS FAR FROM FINISHED)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#first-testing-and-charging-of-the-battery" id="toc-first-testing-and-charging-of-the-battery" class="nav-link active" data-scroll-target="#first-testing-and-charging-of-the-battery">First testing and charging of the battery</a>
  <ul class="collapse">
  <li><a href="#material" id="toc-material" class="nav-link" data-scroll-target="#material">Material</a></li>
  <li><a href="#theory" id="toc-theory" class="nav-link" data-scroll-target="#theory">Theory</a></li>
  <li><a href="#measuring-the-chargedischarge-efficiency-and-the-the-discharge-voltage-as-a-function-of-time" id="toc-measuring-the-chargedischarge-efficiency-and-the-the-discharge-voltage-as-a-function-of-time" class="nav-link" data-scroll-target="#measuring-the-chargedischarge-efficiency-and-the-the-discharge-voltage-as-a-function-of-time">Measuring the charge/discharge efficiency and the the discharge voltage as a function of time</a></li>
  <li><a href="#overpotential-measurement" id="toc-overpotential-measurement" class="nav-link" data-scroll-target="#overpotential-measurement">Overpotential measurement</a></li>
  <li><a href="#terminal-voltage-as-a-function-of-time" id="toc-terminal-voltage-as-a-function-of-time" class="nav-link" data-scroll-target="#terminal-voltage-as-a-function-of-time">Terminal voltage as a function of time</a>
  <ul class="collapse">
  <li><a href="#what-should-be-added-to-this-document" id="toc-what-should-be-added-to-this-document" class="nav-link" data-scroll-target="#what-should-be-added-to-this-document">What should be added to this document?</a></li>
  </ul></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  <li><a href="#appendix-a-deduction-equation-3" id="toc-appendix-a-deduction-equation-3" class="nav-link" data-scroll-target="#appendix-a-deduction-equation-3">Appendix A: Deduction equation 3</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Testing.html">Testing</a></li><li class="breadcrumb-item"><a href="./First_Testing_and_Charging.html">First testing and charging of the battery</a></li></ol></nav></header>




<section id="first-testing-and-charging-of-the-battery" class="level1">
<h1>First testing and charging of the battery</h1>
<p>The first testing the quality of a battery is testing of three quantities of the battery: - The charge/discharge-efficiency. - The overpotential as a function of current run through the battery. Knowing the relation between overpotential and current can tell you something about the internal resistance of the battery and the ideal current for best performance of the battery. - The terminal voltage as a function of time</p>
<section id="material" class="level2">
<h2 class="anchored" data-anchor-id="material">Material</h2>
<ul>
<li>Programmable power Supply (<em>TTi QL335P linear regulated power</em>)</li>
<li>Digilent Analog Discovery 2</li>
<li>Pstrace 5.9 by Palmsens (software)</li>
<li>A rechargeable battery</li>
</ul>
</section>
<section id="theory" class="level2">
<h2 class="anchored" data-anchor-id="theory">Theory</h2>
<p>In a system with no internal resistance, the current or potential through a resistor (or device) can be determined using Ohm’s law:</p>
<p><img src="Formula_Images/OHM.png" class="img-fluid" alt="equation1">   (equation 1)</p>
<p>Where <em>U</em> is the potential in V, <em>I</em> the electrical current in A and <em>R</em> the resistance in Ω. However, the device attached to the battery is not the only resistor in the circuit. The wiring to the the device from the cell and the cell itself also have resistance lowering the voltage through the device upon discharge. This resistance within the circuit is called the internal resistance <em>R</em><sub>int</sub>. The voltage over the battery within the circuit, considering internal restance, is called the terminal voltage <em>U</em><sub>term</sub>. Upon discharge, <em>U</em><sub>term</sub> is lower than the electric potential supplied by the chemical reaction within the battery because part of this potential is “claimed” by the internal resistance of the circuit. The electric potential supplied by the battery to the system is called the electromotive force <em>ε</em>. The terminal voltage can be calculated using the following equation [1]:</p>
<p><img src="Formula_Images/terminal_voltage.png" class="img-fluid" alt="equation2">   (equation 2)</p>
<p>Note that the electromotive force <em>ε</em> is not an actual force but has the unit V (J/C). Upon discharge, <em>U</em><sub>term</sub> is the potential put on the external device. The ±-sign is then a minus, since the potential on the external device is lower than the potential supplied by the battery.<br>
Upon charge, <em>U</em><sub>term</sub> is the potential supplied by the charging device. The ±-sign is then a plus, because an overpotential is required to supply the voltage <em>ε</em> to the battery.<br>
Also note that when <em>R</em><sub>int</sub> → 0, <em>U</em><sub>term</sub> becomes <em>ε</em>. It is required to apply a current to measure the voltage in a circuit. This means it is only possible to acquire <em>ε</em> through extrapolation of measurements of <em>U</em><sub>term</sub> as a function of <em>I</em>.<br>
Considering equation 2 and that that power <em>P = U</em> * <em>I</em>, we can calculate the current at which the power supply of the battery peaks:</p>
<p><img src="Formula_Images/max_P(I).png" class="img-fluid" alt="equation3">   (equation 3)</p>
</section>
<section id="measuring-the-chargedischarge-efficiency-and-the-the-discharge-voltage-as-a-function-of-time" class="level2">
<h2 class="anchored" data-anchor-id="measuring-the-chargedischarge-efficiency-and-the-the-discharge-voltage-as-a-function-of-time">Measuring the charge/discharge efficiency and the the discharge voltage as a function of time</h2>
<p>The charge/discharge efficiency is a measurement of efficiency in energy. The charge/discharge efficiency can be calculated using the following equation:</p>
<p><img src="Formula_Images/(dis)charge_eff.png" class="img-fluid" alt="equation4">   (equation 4)</p>
<p>If your power supply can register the total energy it has used to charge the battery, there’s no need to use the third and forth part of the equation and you can just fill the used energy for charging in <em>E</em><sub>in</sub>.<br>
If your power supply doesn’t show <em>E</em><sub>in</sub>, you’ll need to perform an integration on the used power. In the equation the quantities followed by (<em>t</em>), are the quantities which will need to be integrated over time. If your power supply can register you the used power in W, you’ll need to register the value of the power at periodically while charging. If your power supply only can show the voltage and current, you’ll need to register the current instead, given that the voltage is kept constant. The shorter the time interval of registering the power/current, the more precise the charge/discharge efficiency will be. It won’t be necessary to choose a set time interval. If the current is changing fast over time, it is best to register the often register the current. If the power/current is relatively constant in time, the time interval of registering its value can be longer.<br>
There is a python script within the same folder as this document, which performs an Euler integration. Instructions on how to open and use the script are given in a txt-file in the same folder as the script.</p>
<section id="charging-of-the-battery" class="level4">
<h4 class="anchored" data-anchor-id="charging-of-the-battery">Charging of the battery</h4>
<p>It is now time to charge the battery. Since the efficiency is a quantity of interest, it is important to do this at a voltage as low as possible. It is also a goal to charge the battery as fast as possible. To do both satisfy these commands, we do the following:<br>
We choose to vary the current. We start off at a current of 20 mA and slowly increase the current. To make sure we get a good efficiency and also prevent (too many) other half reactions from happening, we put a maximum voltage limit on the power supply of 1.43 V.</p>
<p>To measure <em>E</em><sub>out</sub>, we use the Digilent Analog Discovery 2 to measure the terminal voltage of the battery as a function of time at fixed current upon discharge. We discharge the cell with a current of 100 mA. In project_instructions.md, it is described how to do this using the Digilent Analog Discovery 2 and Pstrace 5.9. Again, the python script in the same folder as this document can be used to integrate the voltage to find the energy.</p>
</section>
</section>
<section id="overpotential-measurement" class="level2">
<h2 class="anchored" data-anchor-id="overpotential-measurement">Overpotential measurement</h2>
<p>For this measurement, we charge the battery again. How to do this is described above at “Charging of the battery”.<br>
Equation 2 shows the terminal potential will decrease as a fucntion of current run through the battery. The scale of this drop down is unknown beforehand. To get a sense of this scale of the voltage as a function of current, we first conduct the following experiment:<br>
First, we charge the battery. We then manually start at a current as low as possible and wait until the voltage becomes stable. Once stable, we increase the current and wait for the voltage to become stable again. We increase this step until we can make an educated gues on where the voltage goes to zero. Using the script, plot_overpotential.py from the Script_plot_overpotential folder, we plot our results. Instructions on how to use this script are within the same folder.<br>
We then let the Digilent Analog Discovery 2 perform the same experiment. However, the charging of the battery is performed by hand again. The rest of the experiment can be performed using multistep potentiometry in Pstrace 5.9. How to use this program, project_instructions.md can be consulted. We chose the range of current to be at least 10% higher than where we determined that the voltage went to zero. We determine the time interval from how long it took for the voltage to become stable in last experiment. We chose the amount of measurements per time interval to be 2. When the measurements turn out be significantly differ from each other at same current, the amount of measurements should be increased in a future experiments.</p>
</section>
<section id="terminal-voltage-as-a-function-of-time" class="level2">
<h2 class="anchored" data-anchor-id="terminal-voltage-as-a-function-of-time">Terminal voltage as a function of time</h2>
<p>For this measurement, we charge the battery again. How to do this is described above at “Charging of the battery”.<br>
We first charge the battery. By letting a constant current of 100 mA go through the battery, we measure the voltage as a function time. This can be done using a</p>
<section id="what-should-be-added-to-this-document" class="level3">
<h3 class="anchored" data-anchor-id="what-should-be-added-to-this-document">What should be added to this document?</h3>
<ul>
<li>This document should be merged with the project_instructions.md document, which describes how to actually measure the standard potential.</li>
<li>Give a value for at what current the battery should discharge. 100 mA is an arbitrarily chosen value. Also give the name of the program of the Digilent Analog Discovery 2 you need to use if you want to know voltage as a function of time.</li>
<li><strong>Equation 4</strong>: U_term(t) instead of I(t), Pcharge instead of P_in, I also requires subscript</li>
<li>Determine when charging of a battery is completed.</li>
<li>Find out the name of the program in Pstrace 5.9 for determining the voltage as a function of time and find out how it works. Then finish the subsection: “Terminal voltage as a function of time”.</li>
</ul>
</section>
</section>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
<p>[1] Mahesh Shenoy (2021), Cells, EMF, terminal voltage &amp; internal resistance, Khan Acadamy, https://www.khanacademy.org/science/in-in-class-12th-physics-india/in-in-current-electricity/x51bd77206da864f3:cell-emf-terminal-voltage-internal-resistance/v/cells-emf-terminal-voltage-internal-resistance</p>
</section>
<section id="appendix-a-deduction-equation-3" class="level2">
<h2 class="anchored" data-anchor-id="appendix-a-deduction-equation-3">Appendix A: Deduction equation 3</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>